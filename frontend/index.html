<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
  <title>OCR IO - Image to Text Converter</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; min-height:100vh; padding:16px; }
    .container { max-width: 900px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 24px; }
    .header img { width: 100%; max-width: 280px; height: auto; margin-bottom: 16px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
    h1 { font-size: clamp(24px, 5vw, 36px); margin-bottom: 8px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
    .subtitle { font-size: clamp(14px, 3vw, 16px); opacity: 0.95; margin-bottom: 8px; }
    .card { background: rgba(255,255,255,0.98); border-radius: 16px; padding: clamp(20px, 4vw, 32px); box-shadow: 0 20px 60px rgba(0,0,0,0.3); color: #1a202c; margin-bottom: 16px; }
    .banner { background: linear-gradient(135deg,#10b981,#059669); color: #fff; padding: 12px 16px; border-radius: 10px; margin-bottom: 20px; font-size: clamp(12px, 2.5vw, 14px); font-weight: 600; text-align: center; }
    .upload-zone { border: 3px dashed #cbd5e0; border-radius: 12px; padding: clamp(24px, 5vw, 40px); text-align: center; background: #f7fafc; transition: all 0.3s; cursor: pointer; margin-bottom: 16px; }
    .upload-zone:hover, .upload-zone.drag-over { border-color: #667eea; background: #edf2f7; transform: scale(1.02); }
    .upload-zone.has-file { border-color: #10b981; background: #d1fae5; }
    .upload-icon { font-size: clamp(40px, 8vw, 60px); margin-bottom: 12px; }
    .upload-text { font-size: clamp(14px, 3vw, 16px); color: #4a5568; font-weight: 600; margin-bottom: 8px; }
    .upload-hint { font-size: clamp(11px, 2.5vw, 13px); color: #718096; }
    input[type=file] { display: none; }
    button { background: linear-gradient(135deg,#667eea,#764ba2); color: #fff; border: none; padding: clamp(12px, 3vw, 16px) clamp(20px, 4vw, 32px); border-radius: 10px; font-size: clamp(14px, 3vw, 16px); font-weight: 700; width: 100%; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(102,126,234,0.4); }
    button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102,126,234,0.6); }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    #status { margin: 16px 0; font-size: clamp(13px, 2.8vw, 15px); font-weight: 600; min-height: 24px; text-align: center; }
    .result-box { background: #1a202c; color: #e2e8f0; padding: clamp(16px, 3vw, 20px); border-radius: 10px; min-height: 200px; max-height: 60vh; overflow-y: auto; font-size: clamp(13px, 2.8vw, 14px); line-height: 1.7; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New', monospace; margin-bottom: 12px; }
    .result-box:empty::before { content: 'Extracted text will appear here...'; color: #718096; font-style: italic; }
    .copy-btn { background: #48bb78; margin-top: 8px; }
    .copy-btn:hover:not(:disabled) { background: #38a169; }
    .loader { border: 3px solid #e2e8f0; border-top: 3px solid #667eea; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; margin-left: 8px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .footer { text-align: center; margin-top: 24px; font-size: clamp(11px, 2.5vw, 13px); opacity: 0.9; }
    .footer a { color: #fff; text-decoration: underline; }
    @media (max-width: 640px) {
      body { padding: 12px; }
      .card { border-radius: 12px; }
      .result-box { max-height: 50vh; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="/static/images/image-1.jpeg" alt="OCR IO" id="headerImg" />
      <h1>üì∏ OCR IO - Image to Text | CI/CD Enabled üöÄ</h1>
      <p class="subtitle">Extract text from any image instantly</p>
    </div>
    
    <div class="card">
      <div class="banner">üîí 100% Private ‚Ä¢ No Storage ‚Ä¢ No Tracking ‚Ä¢ Unlimited Use</div>
      
      <div class="upload-zone" id="uploadZone">
        <div class="upload-icon">üì§</div>
        <div class="upload-text">Click or drag image here</div>
        <div class="upload-hint">Supports JPG, PNG, GIF, BMP, TIFF, WebP, HEIC</div>
      </div>
      
      <input id="fileInput" type="file" accept="image/*" />
      <button id="extractBtn">üöÄ Extract Text Now</button>
      
      <div id="status"></div>
      <div class="result-box" id="output"></div>
      <button id="copyBtn" class="copy-btn" style="display:none;">üìã Copy to Clipboard</button>
    </div>
    
    <div class="footer">
      Powered by Tesseract OCR ‚Ä¢ <a href="https://github.com" target="_blank">Open Source</a>
    </div>
  </div>
  
  <script>
    const fileInput = document.getElementById('fileInput');
    const uploadZone = document.getElementById('uploadZone');
    const extractBtn = document.getElementById('extractBtn');
    const statusEl = document.getElementById('status');
    const output = document.getElementById('output');
    const copyBtn = document.getElementById('copyBtn');
    const headerImg = document.getElementById('headerImg');
    
    // Alternate header images
    let imgToggle = true;
    setInterval(() => {
      imgToggle = !imgToggle;
      headerImg.src = imgToggle ? '/static/images/image-1.jpeg' : '/static/images/image-2.jpeg';
    }, 5000);
    
    uploadZone.onclick = () => fileInput.click();
    
    fileInput.onchange = () => {
      if (fileInput.files[0]) {
        uploadZone.classList.add('has-file');
        uploadZone.querySelector('.upload-text').textContent = `‚úÖ ${fileInput.files[0].name}`;
        uploadZone.querySelector('.upload-hint').textContent = `Size: ${(fileInput.files[0].size / 1024 / 1024).toFixed(2)} MB`;
        statusEl.innerHTML = '';
      }
    };
    
    extractBtn.onclick = async () => {
      if (!fileInput.files[0]) {
        statusEl.innerHTML = '‚ö†Ô∏è Please select an image first';
        statusEl.style.color = '#f59e0b';
        return;
      }
      
      statusEl.innerHTML = '‚è≥ Processing image... This may take up to 60 seconds <span class="loader"></span>';
      statusEl.style.color = '#667eea';
      extractBtn.disabled = true;
      output.textContent = '';
      copyBtn.style.display = 'none';
      
      const form = new FormData();
      form.append('file', fileInput.files[0]);
      
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 120000); // 2 min timeout
      
      try {
        const res = await fetch('/api/ocr', { 
          method: 'POST', 
          body: form,
          signal: controller.signal
        });
        clearTimeout(timeoutId);
        
        console.log('Response status:', res.status, 'OK:', res.ok);
        
        if (!res.ok) {
          const errorText = await res.text();
          console.error('Error response:', errorText);
          statusEl.innerHTML = '‚ùå Server error (status ' + res.status + '). Please try again.';
          statusEl.style.color = '#ef4444';
          extractBtn.disabled = false;
          return;
        }
        
        const data = await res.json();
        console.log('OCR result length:', data.text?.length);
        output.textContent = data.text || '(No text detected)';
        statusEl.innerHTML = '‚úÖ Text extracted successfully!';
        statusEl.style.color = '#10b981';
        if (data.text && !data.text.startsWith('(')) {
          copyBtn.style.display = 'block';
        }
      } catch (err) {
        console.error('Fetch error:', err);
        clearTimeout(timeoutId);
        if (err.name === 'AbortError') {
          statusEl.innerHTML = '‚ùå Processing timeout (>2 min). Try a smaller image.';
        } else {
          statusEl.innerHTML = '‚ùå Error: ' + err.message;
        }
        statusEl.style.color = '#ef4444';
      }
      
      extractBtn.disabled = false;
    };
    
    copyBtn.onclick = () => {
      navigator.clipboard.writeText(output.textContent).then(() => {
        const orig = copyBtn.textContent;
        copyBtn.textContent = '‚úÖ Copied!';
        setTimeout(() => copyBtn.textContent = orig, 2000);
      });
    };
    
    // Drag and drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(evt => {
      uploadZone.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); });
    });
    
    ['dragenter', 'dragover'].forEach(evt => {
      uploadZone.addEventListener(evt, () => uploadZone.classList.add('drag-over'));
    });
    
    ['dragleave', 'drop'].forEach(evt => {
      uploadZone.addEventListener(evt, () => uploadZone.classList.remove('drag-over'));
    });
    
    uploadZone.addEventListener('drop', e => {
      const files = e.dataTransfer.files;
      if (files.length) {
        fileInput.files = files;
        uploadZone.classList.add('has-file');
        uploadZone.querySelector('.upload-text').textContent = `‚úÖ ${files[0].name}`;
        uploadZone.querySelector('.upload-hint').textContent = `Size: ${(files[0].size / 1024 / 1024).toFixed(2)} MB`;
      }
    });
  </script>
</body>
</html>
